<main class="p-0 m-0">
  <div class="row d-flex justify-content-center">
    <div class="col-12 col-xl-6">
      <form [formGroup]="formulario" (submit)="nuevoUsuarioServicio()"
            [ngClass]="this.mostrar || this.mostrarModificar ? 'inactiveForm':''">
        <div class="row mb-4">
          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="nombre" class="form-label text-start">Nombre <span class="obligatorios">*</span></label>
              <input type="text" name="nombre" id="nombre" class="form-control" placeholder="Nombre"
                     formControlName="nombre">
            </div>
            <div *ngIf="controles.nombre.invalid && (controles.nombre.dirty || controles.nombre.touched)"
                 class="alert alert-secondary" role="alert">
              <span *ngIf="controles.nombre.errors.required">El Nombre es obligatorio.</span>
              <span *ngIf="controles.nombre.errors.pattern">El Nombre no es válido.</span>
            </div>
          </div>

          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="apellidos" class="form-label text-start">Apellidos <span class="obligatorios">*</span></label>
              <input type="text" name="apellidos" id="apellidos" class="form-control "
                     placeholder="Apellidos" formControlName="apellidos">
            </div>
            <div *ngIf="controles.apellidos.invalid && (controles.apellidos.dirty || controles.apellidos.touched)"
                 class="alert alert-secondary"
                 role="alert">
              <span *ngIf="controles.apellidos.errors.required">Los apellidos son obligatorios.</span>
              <span *ngIf="controles.apellidos.errors.pattern">Los apellidos no son válidos.</span>
            </div>

          </div>

          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="expediente" class="form-label text-start">Nº Expediente <span
                class="obligatorios">*</span></label>
              <input type="text" name="dni" id="expediente" class="form-control " placeholder="Nº Expediente"
                     formControlName="expediente">
            </div>
            <div *ngIf="controles.expediente.invalid && (controles.expediente.dirty || controles.expediente.touched)"
                 class="alert alert-secondary" role="alert">
              <span *ngIf="controles.expediente.errors.required">El Expediente es obligatorio.</span>
              <span *ngIf="controles.expediente.errors.pattern">El Expediente consta de mínimo 4 dígitos.</span>

            </div>
          </div>

        </div>

        <div class="row mb-4">


          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="dni" class="form-label text-start">DNI <span class="obligatorios">*</span></label>
              <input type="text" name="dni" id="dni" class="form-control " placeholder="DNI" formControlName="dni">
            </div>
            <div *ngIf="controles.dni.invalid && (controles.dni.dirty || controles.dni.touched)"
                 class="alert alert-secondary" role="alert">
              <span *ngIf="controles.dni.errors.required">El DNI es obligatorio.</span>
              <span *ngIf="controles.dni.errors.pattern">El DNI no es válido.</span>
            </div>
          </div>


          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="fecha_nacimiento" class="form-label text-start">Fecha de Nacimiento <span
                class="obligatorios">*</span></label>
              <input type="date" name="fecha_nacimiento " id="fecha_nacimiento" class="form-control "
                     max='{{getToday()}}'
                     formControlName="fecha_nacimiento">
            </div>
            <div *ngIf="controles.fecha_nacimiento.errors?.fechaExcedida" class="alert alert-secondary" role="alert">
              <span>La fecha de nacimiento no puede ser mayor a la actual.</span>
            </div>
          </div>

          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="sexo" class="form-label text-start">Género <span class="obligatorios">*</span></label>
              <ng-select id="tipoTeleasistencia" formControlName="sexo" id="sexo">
                <ng-option *ngFor="let sexo of listaSexo; let i = index"
                           [value]="sexo">{{sexo}}</ng-option>
              </ng-select>
            </div>
          </div>

        </div>
        <div class="row mb-4">
          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="telefono_fijo" class="form-label text-start">Télefono Fijo</label>
              <input type="tel" name="telefono_fijo" id="telefono_fijo" class="form-control "
                     placeholder="Teléfono Fijo" formControlName="telefono_fijo">
            </div>
            <div
              *ngIf="controles.telefono_fijo.invalid && (controles.telefono_fijo.dirty || controles.telefono_fijo.touched)"
              class="alert alert-secondary" role="alert">
              <span *ngIf="controles.telefono_fijo.errors.pattern">Debe empezar por 9 y tener 9 dígitos</span>
            </div>
          </div>

          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="telefono_movil" class="form-label text-start">Teléfono movil</label>
              <input type="tel" name="telefono_movil" id="telefono_movil" class="form-control "
                     placeholder="Teléfono Movil" formControlName="telefono_movil">
            </div>
            <div
              *ngIf="controles.telefono_movil.invalid && (controles.telefono_movil.dirty || controles.telefono_movil.touched)"
              class="alert alert-secondary" role="alert">
              <span *ngIf="controles.telefono_movil.errors.pattern">Debe empezar por 6 o 7 y tener 9 dígitos</span>
            </div>
          </div>


          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="codigo_postal" class="form-label text-start">Código Postal <span
                class="obligatorios">*</span></label>
              <input type="text" name="codigo_postal" id="codigo_postal" class="form-control "
                     placeholder="CP" formControlName="codigo_postal">
            </div>
            <div
              *ngIf="controles.codigo_postal.invalid && (controles.codigo_postal.dirty || controles.codigo_postal.touched)"
              class="alert alert-secondary" role="alert">
              <span *ngIf="controles.codigo_postal.errors.required">El código postal es obligatorio.</span>
              <span *ngIf="controles.codigo_postal.errors.pattern">La código postal no es válido.</span>
            </div>
          </div>

        </div>

        <div class="row mb-4">
          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="localidad" class="form-label text-start">Localidad <span class="obligatorios">*</span></label>
              <input type="text" name="localidad" id="localidad" class="form-control " placeholder="Localidad"
                     formControlName="localidad">
            </div>
            <div *ngIf="controles.localidad.value.invalid && (controles.localidad.dirty || controles.localidad.touched)"
                 class="alert alert-secondary"
                 role="alert">
              <span *ngIf="controles.localidad.errors.required">La localidad es obligatoria.</span>
            </div>
          </div>
          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="provincia" class="form-label text-start">Provincia <span class="obligatorios">*</span></label>
              <input type="text" name="provincia" id="provincia" class="form-control "
                     required maxlength="200" placeholder="Provincia" formControlName="provincia">
            </div>
            <div *ngIf="controles.provincia.invalid && (controles.provincia.dirty || controles.provincia.touched)"
                 class="alert alert-secondary"
                 role="alert">
              <span *ngIf="controles.provincia.errors.required">La provincia es obligatoria.</span>
            </div>
          </div>

          <div class="col-12 col-lg-4 col-lg-4">
            <div class="form-group">
              <label for="direccion" class="form-label text-start">Dirección <span class="obligatorios">*</span></label>
              <input type="text" name="direccion" id="direccion" class="form-control "
                     placeholder="Dirección" formControlName="direccion">
            </div>
            <div *ngIf="controles.direccion.invalid && (controles.direccion.dirty || controles.direccion.touched)"
                 class="alert alert-secondary"
                 role="alert">
              <span *ngIf="controles.direccion.errors.required">La dirección es obligatoria.</span>
            </div>
          </div>


        </div>

        <div class="row mb-3 form-group">

          <label for="tipos_personas" class="form-label text-start">Tipo de persona <span
            class="obligatorios">*</span></label>
          <div class="col-12 col-lg pb-1 pb-lg-0">
            <ng-select id="tipos_personas" formControlName="tipos_personas">
              <ng-option *ngFor="let tipo_persona of tipos_personas; let i = index"
                         [value]="tipo_persona.id">{{tipo_persona.nombre}}</ng-option>
            </ng-select>
          </div>
          <ng-container *ngIf="this.isAdmin">
            <div class="col-4 col-lg-1  p-0">
              <button class="btn btn-success botonOperacion" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseWidthExample" aria-expanded="false"
                      aria-controls="collapseWidthExample" (click)="mostratCrearTipo()">
                <i class="fa-solid fa-circle-plus"></i>
              </button>
            </div>
            <div class="col-4 col-lg-1  p-0">
              <button class="btn btn-warning botonOperacion" id="des1" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseWidthExample2" aria-expanded="false"
                      aria-controls="collapseWidthExample2" (click)="mostrarEditarTipo()" [disabled]="desactivado()">
                <i class="fa fa-sharp fa-solid fa-pen fa-sm"></i>
              </button>
            </div>
            <div class="col-4 col-lg-1  p-0">
              <button class="btn btn-danger botonOperacion" id="des2" type="button" [disabled]="desactivado()"
                      (click)="modalConfirmacion()">
                <i class="fa fa-solid fa-trash"></i>
              </button>
            </div>
          </ng-container>
        </div>
        <div class="row">
          <div class="form-group col-12">
            <label for="text_area" class="form-label text-start">Observaciones</label>
            <textarea formControlName="text_area" name="text_area" id="text_area" class="form-control"
                      rows="5"></textarea>
          </div>
        </div>
        <div class="text-center">
          <button [disabled]="formulario.invalid" type="submit" class="btn btn-outline-success m-1" (click)="contraer()"
                  data-bs-toggle="collapse"
                  data-bs-target="#datosPersonales ,#datosSanitarios" aria-expanded="false"
                  aria-controls="datosPersonales">
            Guardar
          </button>
          <button type="button" class="btn btn-outline-secondary m-1" [routerLink]="['/usuarios_del_servicio/consultar']">Volver</button>
        </div>
      </form>
    </div>
    <div class="col-12 col-xl-6 collapse collapse-horizontal m-auto text-center" id="collapseWidthExample">
      <app-crear-tipo-modalidad-paciente (mostrar)="this.mostrar=$event" (refresco)="actualizarModalidades($event)">
      </app-crear-tipo-modalidad-paciente>
    </div>

    <div class="col-12 col-xl-6 collapse collapse-horizontal m-auto text-center" id="collapseWidthExample2">
      <app-modificar-tipo-modalidad-paciente
        (mostrarModificar)="this.mostrarModificar=$event;refresco()"
        *ngIf="this.mostrarModificar"
        [listaTiposModalidad]="tipos_personas" [idTipoModalidad]="formulario.value.tipos_personas">
      </app-modificar-tipo-modalidad-paciente>
    </div>
  </div>
</main>
